/*!
 * =============================================================
 * dropify v0.2.2 - Override your input files with style.
 * https://github.com/JeremyFagis/dropify
 *
 * (c) 2017 - Jeremy FAGIS <jeremy@fagis.fr> (http://fagis.fr)
 * =============================================================
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"))}else{a.Dropify=b(a.jQuery)}}}(this,function(c){var b="dropify";function a(e,d){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob)){return}var f={defaultFile:"",maxFileSize:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,showRemove:true,showLoader:true,showErrors:true,errorTimeout:3000,errorsPosition:"overlay",imgFileExtensions:["png","jpg","jpeg","gif","bmp"],maxFileSizePreview:"5M",allowedFormats:["portrait","square","landscape"],allowedFileExtensions:["*"],messages:{"default":"Drag and drop a file here or click",replace:"Drag and drop or click to replace",remove:"Remove",error:"Ooops, something wrong happended."},error:{fileSize:"The file size is too big ({{ value }} max).",minWidth:"The image width is too small ({{ value }}}px min).",maxWidth:"The image width is too big ({{ value }}}px max).",minHeight:"The image height is too small ({{ value }}}px min).",maxHeight:"The image height is too big ({{ value }}px max).",imageFormat:"The image format is not allowed ({{ value }} only).",fileExtension:"The file is not allowed ({{ value }} only)."},tpl:{wrap:'<div class="dropify-wrapper"></div>',loader:'<div class="dropify-loader"></div>',message:'<div class="dropify-message"><span class="file-icon" /> <p>{{ default }}</p></div>',preview:'<div class="dropify-preview"><span class="dropify-render"></span><div class="dropify-infos"><div class="dropify-infos-inner"><p class="dropify-infos-message">{{ replace }}</p></div></div></div>',filename:'<p class="dropify-filename"><span class="dropify-filename-inner"></span></p>',clearButton:'<button type="button" class="dropify-clear">{{ remove }}</button>',errorLine:'<p class="dropify-error">{{ error }}</p>',errorsContainer:'<div class="dropify-errors-container"><ul></ul></div>'}};this.element=e;this.input=c(this.element);this.wrapper=null;this.preview=null;this.filenameWrapper=null;this.settings=c.extend(true,f,d,this.input.data());this.errorsEvent=c.Event("dropify.errors");this.isDisabled=false;this.isInit=false;this.file={object:null,name:null,size:null,width:null,height:null,type:null};if(!Array.isArray(this.settings.allowedFormats)){this.settings.allowedFormats=this.settings.allowedFormats.split(" ")}if(!Array.isArray(this.settings.allowedFileExtensions)){this.settings.allowedFileExtensions=this.settings.allowedFileExtensions.split(" ")}this.onChange=this.onChange.bind(this);this.clearElement=this.clearElement.bind(this);this.onFileReady=this.onFileReady.bind(this);this.translateMessages();this.createElements();this.setContainerSize();this.errorsEvent.errors=[];this.input.on("change",this.onChange)}a.prototype.onChange=function(){this.resetPreview();this.readFile(this.element)};a.prototype.createElements=function(){this.isInit=true;this.input.wrap(c(this.settings.tpl.wrap));this.wrapper=this.input.parent();var d=c(this.settings.tpl.message).insertBefore(this.input);c(this.settings.tpl.errorLine).appendTo(d);if(this.input.attr("disabled")){this.isDisabled=true;this.wrapper.addClass("disabled")}if(this.settings.showLoader===true){this.loader=c(this.settings.tpl.loader);this.loader.insertBefore(this.input)}this.preview=c(this.settings.tpl.preview);this.preview.insertAfter(this.input);if(this.isDisabled===false&&this.settings.showRemove===true){this.clearButton=c(this.settings.tpl.clearButton);this.clearButton.insertAfter(this.input);this.clearButton.on("click",this.clearElement)}this.filenameWrapper=c(this.settings.tpl.filename);this.filenameWrapper.prependTo(this.preview.find(".dropify-infos-inner"));if(this.settings.showErrors===true){this.errorsContainer=c(this.settings.tpl.errorsContainer);if(this.settings.errorsPosition==="outside"){this.errorsContainer.insertAfter(this.wrapper)}else{this.errorsContainer.insertBefore(this.input)}}var e=this.settings.defaultFile||"";if(e.trim()!==""){this.file.name=this.cleanFilename(e);this.setPreview(this.isImage(),e)}};a.prototype.readFile=function(e){if(e.files&&e.files[0]){var d=new FileReader();var i=new Image();var h=e.files[0];var g=null;var j=this;var f=c.Event("dropify.fileReady");this.clearErrors();this.showLoader();this.setFileInformations(h);this.errorsEvent.errors=[];this.checkFileSize();this.isFileExtensionAllowed();if(this.isImage()&&this.file.size<this.sizeToByte(this.settings.maxFileSizePreview)){this.input.on("dropify.fileReady",this.onFileReady);d.readAsDataURL(h);d.onload=function(k){g=k.target.result;i.src=k.target.result;i.onload=function(){j.setFileDimensions(this.width,this.height);j.validateImage();j.input.trigger(f,[true,g])}}.bind(this)}else{this.onFileReady(false)}}};a.prototype.onFileReady=function(j,e,k){this.input.off("dropify.fileReady",this.onFileReady);if(this.errorsEvent.errors.length===0){this.setPreview(e,k)}else{this.input.trigger(this.errorsEvent,[this]);for(var f=this.errorsEvent.errors.length-1;f>=0;f--){var h=this.errorsEvent.errors[f].namespace;var d=h.split(".").pop();this.showError(d)}if(typeof this.errorsContainer!=="undefined"){this.errorsContainer.addClass("visible");var g=this.errorsContainer;setTimeout(function(){g.removeClass("visible")},this.settings.errorTimeout)}this.wrapper.addClass("has-error");this.resetPreview();this.clearElement()}};a.prototype.setFileInformations=function(d){this.file.object=d;this.file.name=d.name;this.file.size=d.size;this.file.type=d.type;this.file.width=null;this.file.height=null};a.prototype.setFileDimensions=function(e,d){this.file.width=e;this.file.height=d};a.prototype.setPreview=function(d,g){this.wrapper.removeClass("has-error").addClass("has-preview");this.filenameWrapper.children(".dropify-filename-inner").html(this.file.name);var e=this.preview.children(".dropify-render");this.hideLoader();if(d===true){var f=c("<img />").attr("src",g);if(this.settings.height){f.css("max-height",this.settings.height)}f.appendTo(e)}else{c("<i />").attr("class","dropify-font-file").appendTo(e);c('<span class="dropify-extension" />').html(this.getFileType()).appendTo(e)}this.preview.fadeIn()};a.prototype.resetPreview=function(){this.wrapper.removeClass("has-preview");var d=this.preview.children(".dropify-render");d.find(".dropify-extension").remove();d.find("i").remove();d.find("img").remove();this.preview.hide();this.hideLoader()};a.prototype.cleanFilename=function(e){var d=e.split("\\").pop();if(d==e){d=e.split("/").pop()}return e!==""?d:""};a.prototype.clearElement=function(){if(this.errorsEvent.errors.length===0){var d=c.Event("dropify.beforeClear");this.input.trigger(d,[this]);if(d.result!==false){this.resetFile();this.input.val("");this.resetPreview();this.input.trigger(c.Event("dropify.afterClear"),[this])}}else{this.resetFile();this.input.val("");this.resetPreview()}};a.prototype.resetFile=function(){this.file.object=null;this.file.name=null;this.file.size=null;this.file.type=null;this.file.width=null;this.file.height=null};a.prototype.setContainerSize=function(){if(this.settings.height){this.wrapper.height(this.settings.height)}};a.prototype.isTouchDevice=function(){return(("ontouchstart" in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0))};a.prototype.getFileType=function(){return this.file.name.split(".").pop().toLowerCase()};a.prototype.isImage=function(){if(this.settings.imgFileExtensions.indexOf(this.getFileType())!="-1"){return true}return false};a.prototype.isFileExtensionAllowed=function(){if(this.settings.allowedFileExtensions.indexOf("*")!="-1"||this.settings.allowedFileExtensions.indexOf(this.getFileType())!="-1"){return true}this.pushError("fileExtension");return false};a.prototype.translateMessages=function(){for(var d in this.settings.tpl){for(var e in this.settings.messages){this.settings.tpl[d]=this.settings.tpl[d].replace("{{ "+e+" }}",this.settings.messages[e])}}};a.prototype.checkFileSize=function(){if(this.sizeToByte(this.settings.maxFileSize)!==0&&this.file.size>this.sizeToByte(this.settings.maxFileSize)){this.pushError("fileSize")}};a.prototype.sizeToByte=function(d){var g=0;if(d!==0){var f=d.slice(-1).toUpperCase(),e=1024,i=e*1024,h=i*1024;if(f==="K"){g=parseFloat(d)*e}else{if(f==="M"){g=parseFloat(d)*i}else{if(f==="G"){g=parseFloat(d)*h}}}}return g};a.prototype.validateImage=function(){if(this.settings.minWidth!==0&&this.settings.minWidth>=this.file.width){this.pushError("minWidth")}if(this.settings.maxWidth!==0&&this.settings.maxWidth<=this.file.width){this.pushError("maxWidth")}if(this.settings.minHeight!==0&&this.settings.minHeight>=this.file.height){this.pushError("minHeight")}if(this.settings.maxHeight!==0&&this.settings.maxHeight<=this.file.height){this.pushError("maxHeight")}if(this.settings.allowedFormats.indexOf(this.getImageFormat())=="-1"){this.pushError("imageFormat")}};a.prototype.getImageFormat=function(){if(this.file.width==this.file.height){return"square"}if(this.file.width<this.file.height){return"portrait"}if(this.file.width>this.file.height){return"landscape"}};a.prototype.pushError=function(d){var f=c.Event("dropify.error."+d);this.errorsEvent.errors.push(f);this.input.trigger(f,[this])};a.prototype.clearErrors=function(){if(typeof this.errorsContainer!=="undefined"){this.errorsContainer.children("ul").html("")}};a.prototype.showError=function(d){if(typeof this.errorsContainer!=="undefined"){this.errorsContainer.children("ul").append("<li>"+this.getError(d)+"</li>")}};a.prototype.getError=function(d){var e=this.settings.error[d],f="";if(d==="fileSize"){f=this.settings.maxFileSize}else{if(d==="minWidth"){f=this.settings.minWidth}else{if(d==="maxWidth"){f=this.settings.maxWidth}else{if(d==="minHeight"){f=this.settings.minHeight}else{if(d==="maxHeight"){f=this.settings.maxHeight}else{if(d==="imageFormat"){f=this.settings.allowedFormats.join(", ")}else{if(d==="fileExtension"){f=this.settings.allowedFileExtensions.join(", ")}}}}}}}if(f!==""){return e.replace("{{ value }}",f)}return e};a.prototype.showLoader=function(){if(typeof this.loader!=="undefined"){this.loader.show()}};a.prototype.hideLoader=function(){if(typeof this.loader!=="undefined"){this.loader.hide()}};a.prototype.destroy=function(){this.input.siblings().remove();this.input.unwrap();this.isInit=false};a.prototype.init=function(){this.createElements()};a.prototype.isDropified=function(){return this.isInit};c.fn[b]=function(d){this.each(function(){if(!c.data(this,b)){c.data(this,b,new a(this,d))}});return this};return a}));(function(a){a('[data-plugin="dropify"]').dropify()}(jQuery));